<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MX$ — Calculadora</title>
<style>
  :root{font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif}
  body{background:#f6f7fb;color:#111;margin:0;padding:24px;display:flex;justify-content:center}
  .container{width:980px;max-width:96%;background:#fff;border-radius:12px;box-shadow:0 6px 30px rgba(20,25,40,0.08);padding:22px}
  h1{font-size:40px;margin:0 0 14px;color:#0b3b66}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
  label{font-size:13px;color:#334;display:block;margin-bottom:6px}
  input[type="text"],input[type="number"]{padding:10px 12px;border:1px solid #d7dde8;border-radius:8px;font-size:14px;width:100%;box-sizing:border-box}
  .col{flex:1;min-width:140px}
  .small{width:140px}
  .btn{background:#0b66a3;color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  .btn.secondary{background:#e6eef7;color:#0b3b66}
  .btn.danger{background:#e24b4b}
  .output{background:#f3f6fb;padding:12px;border-radius:8px;border:1px solid #e8edf6}
  .summary{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
  .card{flex:1;min-width:220px;padding:12px;border-radius:8px;background:#fff;border:1px solid #eef3fa}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border-bottom:1px solid #f0f3f8;text-align:left;font-size:13px}
  th{background:#fbfdff;font-weight:700}
  .profit{background:#eaffef}
  .loss{background:#fff0f0}
  .center{text-align:center}
  .muted{color:#6b7a8a;font-size:13px}
  .small-note{font-size:12px;color:#6b7a8a;margin-top:6px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .flex-right{display:flex;justify-content:flex-end;gap:8px}
  @media(max-width:720px){.row{flex-direction:column}.flex-right{justify-content:flex-start}}
</style>
</head>
<body>
<div class="container" role="main">
  <h1>MX$</h1>

  <!-- SALDO -->
  <div class="row" style="align-items:end">
    <div class="col small">
      <label for="saldoInicial">Saldo inicial (R$)</label>
      <input id="saldoInicial" type="number" step="0.01" min="0" />
    </div>
    <div class="col small">
      <label for="saldoAtual">Saldo atual (R$)</label>
      <input id="saldoAtual" type="text" readonly />
      <div class="small-note">Saldo = saldo inicial + histórico de lucro/prejuízo</div>
    </div>
    <div class="col" style="flex:2">
      <label>Histórico acumulado (R$)</label>
      <input id="histAcumulado" type="text" readonly />
    </div>
  </div>

  <!-- TIMES -->
  <div class="row">
    <div class="col">
      <label for="timeA">Time A</label>
      <input id="timeA" type="text" placeholder="Nome do time A (opcional)"/>
    </div>
    <div class="col">
      <label for="timeB">Time B</label>
      <input id="timeB" type="text" placeholder="Nome do time B (opcional)"/>
    </div>
  </div>

  <!-- ODDS -->
  <div class="row">
    <div class="col small">
      <label for="oddA">Odd 1</label>
      <input id="oddA" type="number" step="0.01" min="1" placeholder="ex: 1.57"/>
    </div>
    <div class="col small">
      <label for="oddB">Odd 2</label>
      <input id="oddB" type="number" step="0.01" min="1" placeholder="ex: 1.62"/>
    </div>
    <div class="col small">
      <label for="valorTotal">Valor total a apostar (R$)</label>
      <input id="valorTotal" type="number" step="0.01" min="0" />
    </div>
    <div class="col small">
      <label for="qtdPerdidas">Quantas apostas perderam?</label>
      <input id="qtdPerdidas" type="number" step="1" min="0" max="2" value="0" />
      <div class="small-note">Use 0, 1 ou 2 antes de "Aposta concluída"</div>
    </div>
  </div>

  <!-- BOTOES DE AÇÃO -->
  <div class="row">
    <div class="controls">
      <button id="btnCalcular" class="btn">Calcular distribuição</button>
      <button id="btnConcluir" class="btn secondary">Aposta concluída</button>
      <button id="btnResetHist" class="btn danger">Resetar histórico</button>
      <button id="btnApagarUlt" class="btn secondary">Apagar última aposta</button>
    </div>
  </div>

  <!-- RESULTADOS -->
  <div class="row">
    <div class="output" style="width:100%">
      <div class="summary" id="resultArea">
        <div class="card">
          <strong>Distribuição</strong>
          <div id="distInfo" class="muted">Nenhum cálculo executado ainda.</div>
        </div>
        <div class="card">
          <strong>Se apenas 1 acerta</strong>
          <div id="oneWin" class="muted">—</div>
        </div>
        <div class="card">
          <strong>Se ambas acertam</strong>
          <div id="bothWin" class="muted">—</div>
        </div>
      </div>
    </div>
  </div>

  <!-- HISTÓRICO -->
  <div class="row">
    <div style="width:100%">
      <h3 style="margin:10px 0 6px">Histórico de apostas</h3>
      <div class="small-note">Cada linha: nº | data | valor apostado | resultado (R$) | % em relação ao total | (verde = ganho, vermelho = prejuízo)</div>
      <table id="histTable" aria-live="polite">
        <thead>
          <tr><th>#</th><th>Data</th><th>Valor</th><th>Ganho/Prejuízo (R$)</th><th>% do total</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<script>
/* MX$ — script */
(function(){
  // Elements
  const saldoInicialEl = document.getElementById('saldoInicial');
  const saldoAtualEl = document.getElementById('saldoAtual');
  const histAcumuladoEl = document.getElementById('histAcumulado');
  const oddAEl = document.getElementById('oddA');
  const oddBEl = document.getElementById('oddB');
  const valorTotalEl = document.getElementById('valorTotal');
  const btnCalcular = document.getElementById('btnCalcular');
  const btnConcluir = document.getElementById('btnConcluir');
  const btnResetHist = document.getElementById('btnResetHist');
  const btnApagarUlt = document.getElementById('btnApagarUlt');
  const distInfo = document.getElementById('distInfo');
  const oneWin = document.getElementById('oneWin');
  const bothWin = document.getElementById('bothWin');
  const histTbody = document.querySelector('#histTable tbody');
  const qtdPerdidasEl = document.getElementById('qtdPerdidas');

  // LocalStorage keys
  const KEY_SALDO = 'mx_saldoInicial';
  const KEY_HISTORY = 'mx_history';

  // State
  let history = []; // array of {date, valor, resultado, percent}
  let saldoInicial = 0;

  // Utility
  function fmtMoney(v){ return Number(v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}); }
  function nowDate(){ const d=new Date(); return d.toLocaleString('pt-BR'); }

  // Load from localStorage
  function load(){
    const s = localStorage.getItem(KEY_SALDO);
    saldoInicial = s ? parseFloat(s) : 0;
    const h = localStorage.getItem(KEY_HISTORY);
    history = h ? JSON.parse(h) : [];
    renderAll();
  }

  function save(){
    localStorage.setItem(KEY_SALDO, String(saldoInicial));
    localStorage.setItem(KEY_HISTORY, JSON.stringify(history));
  }

  // Render history table and saldo
  function renderAll(){
    // Fill inputs
    saldoInicialEl.value = saldoInicial ? saldoInicial : '';
    // Compute accumulated profit
    const acum = history.reduce((s,it)=> s + Number(it.resultado),0);
    histAcumuladoEl.value = 'R$ ' + fmtMoney(acum);
    saldoAtualEl.value = 'R$ ' + fmtMoney((saldoInicial||0) + acum);

    // Render history rows
    histTbody.innerHTML = '';
    history.forEach((it, idx) => {
      const tr = document.createElement('tr');
      tr.className = Number(it.resultado) >= 0 ? 'profit' : 'loss';
      const num = document.createElement('td'); num.textContent = idx+1;
      const dt = document.createElement('td'); dt.textContent = it.date;
      const val = document.createElement('td'); val.textContent = 'R$ ' + fmtMoney(it.valor);
      const res = document.createElement('td'); res.textContent = (Number(it.resultado) >=0 ? '+' : '') + 'R$ ' + fmtMoney(it.resultado);
      const pc = document.createElement('td'); pc.textContent = (Number(it.percent) >=0 ? '+' : '') + Number(it.percent).toFixed(2) + '%';
      tr.appendChild(num); tr.appendChild(dt); tr.appendChild(val); tr.appendChild(res); tr.appendChild(pc);
      histTbody.appendChild(tr);
    });
  }

  // When user changes saldo inicial: save
  saldoInicialEl.addEventListener('change', () => {
    const v = parseFloat(saldoInicialEl.value);
    saldoInicial = isFinite(v) ? v : 0;
    save();
    renderAll();
  });

  // Calculation function (two odds)
  function calcularDistribuicao(){
    const o1 = parseFloat(oddAEl.value);
    const o2 = parseFloat(oddBEl.value);
    const T = parseFloat(valorTotalEl.value);
    if(!(o1>0 && o2>0 && T>0)){
      alert('Preencha corretamente as odds e o valor total (maior que zero).');
      return null;
    }
    // inversos
    const inv1 = 1 / o1;
    const inv2 = 1 / o2;
    const somaInv = inv1 + inv2;
    // stakes
    const A1 = (T / o1) / somaInv;
    const A2 = (T / o2) / somaInv;
    // guaranteed equal return R (se apenas 1 acerta)
    const R = T / somaInv; // este é o retorno (inclui stake)
    // returns
    const retOne = R; // retorno se apenas 1 acerta
    const profitOne = retOne - T;
    // se as duas acertarem:
    const retBoth = (A1 * o1) + (A2 * o2); // normalmente = R + R = 2R
    const profitBoth = retBoth - T;
    // percentages
    const pctOne = (profitOne / T) * 100;
    const pctBoth = (profitBoth / T) * 100;
    // Round sensible
    function r(v){ return Math.round(v*100)/100;}
    const result = {
      A1: r(A1),
      A2: r(A2),
      R: r(R),
      retOne: r(retOne),
      profitOne: r(profitOne),
      pctOne: r(pctOne),
      retBoth: r(retBoth),
      profitBoth: r(profitBoth),
      pctBoth: r(pctBoth),
      T: r(T),
      o1, o2
    };
    return result;
  }

  // Show calculation results in UI
  btnCalcular.addEventListener('click', ()=>{
    const res = calcularDistribuicao();
    if(!res) return;
    distInfo.innerHTML = `
      <div><strong>Stake 1:</strong> R$ ${fmtMoney(res.A1)} (Odd ${res.o1})</div>
      <div><strong>Stake 2:</strong> R$ ${fmtMoney(res.A2)} (Odd ${res.o2})</div>
      <div class="small-note">Retorno igual esperado ao acertar apenas 1 aposta: R$ ${fmtMoney(res.R)}</div>
    `;
    oneWin.innerHTML = `
      <div><strong>Retorno:</strong> R$ ${fmtMoney(res.retOne)}</div>
      <div><strong>Lucro/Prejuízo:</strong> ${res.profitOne >=0 ? '+' : ''}R$ ${fmtMoney(res.profitOne)}</div>
      <div class="muted"><strong>% sobre o total:</strong> ${res.pctOne.toFixed(2)}%</div>
    `;
    bothWin.innerHTML = `
      <div><strong>Retorno total (ambas vencem):</strong> R$ ${fmtMoney(res.retBoth)}</div>
      <div><strong>Lucro/Prejuízo:</strong> ${res.profitBoth >=0 ? '+' : ''}R$ ${fmtMoney(res.profitBoth)}</div>
      <div class="muted"><strong>% sobre o total:</strong> ${res.pctBoth.toFixed(2)}%</div>
    `;
  });

  // Concluir aposta: usa qtdPerdidas para definir resultado e adiciona ao histórico
  btnConcluir.addEventListener('click', ()=>{
    const res = calcularDistribuicao();
    if(!res) return;
    const lost = parseInt(qtdPerdidasEl.value,10);
    if(isNaN(lost) || lost < 0 || lost > 2){
      alert('Defina quantas apostas perderam: 0, 1 ou 2.');
      return;
    }
    let resultado = 0;
    // wins = 2 - lost
    const wins = 2 - lost;
    if(wins === 2){
      resultado = res.profitBoth; // lucro se ambas acertarem
    } else if(wins === 1){
      resultado = res.profitOne; // lucro se apenas uma
    } else {
      resultado = -res.T; // perderam tudo
    }

    // push history entry
    const entry = {
      date: nowDate(),
      valor: Number(res.T),
      resultado: Number(Number(resultado).toFixed(2)),
      percent: Number(((resultado / res.T) * 100).toFixed(2))
    };
    history.push(entry);

    // Update saldo atual: saldoInicial stored separately; renderAll compute acum
    save();
    renderAll();

    // clear fields (except saldo inicial)
    oddAEl.value=''; oddBEl.value=''; valorTotalEl.value=''; qtdPerdidasEl.value='0';
    distInfo.innerHTML = 'Nenhum cálculo executado ainda.';
    oneWin.innerHTML = '—';
    bothWin.innerHTML = '—';
  });

  // Reset history
  btnResetHist.addEventListener('click', ()=>{
    if(!confirm('Resetar histórico apagará todas as apostas salvas. Deseja continuar?')) return;
    history = [];
    save();
    renderAll();
  });

  // Apagar última aposta
  btnApagarUlt.addEventListener('click', ()=>{
    if(history.length === 0) { alert('Histórico vazio.'); return; }
    if(!confirm('Remover a última aposta registrada?')) return;
    history.pop();
    save();
    renderAll();
  });

  // initial load
  load();

  // expose for debugging (optional)
  window.mx = {
    getState: ()=>({saldoInicial,history}),
    clearAll: ()=>{ localStorage.removeItem(KEY_SALDO); localStorage.removeItem(KEY_HISTORY); saldoInicial=0; history=[]; renderAll(); }
  };
})();
</script>
</body>
</html>
