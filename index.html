  <!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MX$ - Calculadora de Distribuição</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa7bf;
      --accent:#10b981;
      --danger:#ef4444;
      --panel:#0b1220;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#071029 0%, #092032 60%);color:#e6eef8;padding:28px;}
    .wrap{max-width:980px;margin:0 auto}
    header {text-align:center;margin-bottom:18px}
    h1{font-size:44px;margin:0;color:#fff;letter-spacing:1px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .full{grid-column:1/-1}
    .card{background:var(--panel);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="number"], select{
      width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#e6eef8;
      font-size:15px;
    }
    .row{display:flex;gap:8px}
    .btn{padding:10px 14px;border-radius:10px;border:0;background:#0ea5a4;color:#042027;font-weight:600;cursor:pointer}
    .btn.secondary{background:#1f2937;color:#fff}
    .btn.red{background:var(--danger);color:#fff}
    .outputs{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .output{flex:1;min-width:180px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:10px}
    .big{font-size:20px;font-weight:700;color:#fff}
    .muted{color:var(--muted);font-size:13px}
    .history{margin-top:12px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th, td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;color:#dbeafe}
    th{font-size:13px;color:var(--muted)}
    .green{background:linear-gradient(90deg, rgba(16,185,129,0.08), rgba(16,185,129,0.02));color:#b7f1d8}
    .red{background:linear-gradient(90deg, rgba(239,68,68,0.08), rgba(239,68,68,0.02));color:#ffd6d6}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .flex-between{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .note{font-size:13px;color:var(--muted);margin-top:6px}
    .muted-2{color:#9fb3cc;font-size:13px}
    .inline{display:inline-block}
    @media(max-width:820px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>MX$</h1>
      <div class="note">Calculadora de distribuição proporcional — retorno igual</div>
    </header>

    <div class="grid">
      <!-- Left column: saldo e multiplicadores -->
      <div class="card">
        <label>Saldo inicial (R$)</label>
        <input id="saldoInicial" type="number" step="0.01" min="0" />

        <div style="height:8px"></div>

        <label>Saldo atual (calculado)</label>
        <input id="saldoAtual" type="text" readonly />

        <div style="height:10px"></div>
        <label>Multiplicadores (mantidos ao resetar campos)</label>
        <div class="row">
          <input id="multGanho" type="number" step="0.01" value="1" title="Multiplicador aplicável a ganhos" />
          <input id="mult1Perda" type="number" step="0.01" value="1" title="Multiplicador aplicável a 1 aposta perdida" />
          <input id="mult2Perda" type="number" step="0.01" value="1" title="Multiplicador aplicável a 2 apostas perdidas" />
        </div>
        <div class="small" style="margin-top:8px">Use os multiplicadores para ajustar (por exemplo: estratégias de gestão).</div>
      </div>

      <!-- Right column: times e odds -->
      <div class="card">
        <label>Time 1 (opcional)</label>
        <input id="team1" type="text" placeholder="Time 1" />

        <div style="height:8px"></div>

        <label>Time 2 (opcional)</label>
        <input id="team2" type="text" placeholder="Time 2" />

        <div style="height:8px"></div>

        <label>Odd Time 1</label>
        <input id="odd1" type="number" step="0.01" min="1" placeholder="Ex: 1.75" />

        <div style="height:8px"></div>

        <label>Odd Time 2</label>
        <input id="odd2" type="number" step="0.01" min="1" placeholder="Ex: 2.10" />
      </div>

      <!-- Full width: apostas e ações -->
      <div class="card full">
        <div class="grid" style="grid-template-columns:1fr 220px;align-items:end;gap:12px">
          <div>
            <label>Valor total a apostar (T)</label>
            <input id="totalApostado" type="number" step="0.01" min="0" placeholder="Ex: 100" />
          </div>
          <div>
            <label>Quantas apostas perderam?</label>
            <select id="apostasPerdidas">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
            </select>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="controls">
          <button id="btnCalcular" class="btn">Calcular distribuição</button>
          <button id="btnApostaConcluida" class="btn secondary">Aposta concluída</button>
          <button id="btnResetCampos" class="btn secondary">Resetar campos (não multipliers)</button>
          <button id="btnApagarUltima" class="btn" style="background:#374151;color:#fff">Apagar última aposta</button>
          <button id="btnResetHist" class="btn red">Resetar histórico</button>
        </div>

        <div class="outputs" id="outputs">
          <div class="output">
            <div class="muted">Valor a apostar — Aposta 1</div>
            <div id="stake1" class="big">-</div>
            <div class="muted-2" id="stake1Detail"></div>
          </div>
          <div class="output">
            <div class="muted">Valor a apostar — Aposta 2</div>
            <div id="stake2" class="big">-</div>
            <div class="muted-2" id="stake2Detail"></div>
          </div>
          <div class="output" style="min-width:260px">
            <div class="muted">Resultado se <strong>apenas 1</strong> aposta vencer</div>
            <div id="oneWin" class="big">-</div>
            <div class="muted-2" id="oneWinPct"></div>
          </div>
          <div class="output" style="min-width:260px">
            <div class="muted">Resultado se <strong>ambas</strong> apostas vencerem</div>
            <div id="bothWin" class="big">-</div>
            <div class="muted-2" id="bothWinPct"></div>
          </div>
        </div>

        <div class="note" style="margin-top:10px">
          Observações: o campo "Quantas apostas perderam?" define o resultado da aposta ao clicar em <strong>Aposta concluída</strong>:
          <ul style="margin:6px 0 0 18px;color:var(--muted);">
            <li>0 → considera que ambas ganharam;</li>
            <li>1 → considera que apenas 1 ganhou (o retorno igual R aplica-se aqui);</li>
            <li>2 → ambas perderam (prejuízo = -T).</li>
          </ul>
        </div>
      </div>

      <!-- Histórico -->
      <div class="card full">
        <div class="flex-between">
          <div>
            <h3 style="margin:0;color:#fff">Histórico de apostas</h3>
            <div class="small">As apostas são salvas em <code>localStorage</code> e o saldo é atualizado automaticamente.</div>
          </div>
          <div class="small muted">Total entradas: <span id="histCount">0</span></div>
        </div>

        <div class="history">
          <table id="historyTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Data</th>
                <th>Valor apostado (R$)</th>
                <th>Resultado (R$)</th>
                <th>% sobre T</th>
                <th>Obs</th>
              </tr>
            </thead>
            <tbody id="historyBody">
              <!-- preenchido por JS -->
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

<script>
/*
  MX$ - Calculadora de distribuição proporcional (retorno igual)
  - armazenamento: localStorage keys: mx_saldoInicial, mx_history, mx_multipliers
  - histórico: array de {date, total, result, pct, note}
*/

const $ = id => document.getElementById(id);

const stateKeys = {
  saldoInicial: 'mx_saldoInicial_v1',
  history: 'mx_history_v1',
  multipliers: 'mx_mults_v1'
};

function formatMoney(v){
  return Number(v || 0).toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});
}

function loadState(){
  const si = parseFloat(localStorage.getItem(stateKeys.saldoInicial) || '0');
  $('saldoInicial').value = isNaN(si) ? '' : si;

  // multipliers
  const mults = JSON.parse(localStorage.getItem(stateKeys.multipliers) || '{"gain":1,"loss1":1,"loss2":1}');
  $('multGanho').value = mults.gain ?? 1;
  $('mult1Perda').value = mults.loss1 ?? 1;
  $('mult2Perda').value = mults.loss2 ?? 1;

  renderHistory();
  updateSaldoAtual();
}

function saveMultipliers(){
  const mults = {
    gain: parseFloat($('multGanho').value) || 1,
    loss1: parseFloat($('mult1Perda').value) || 1,
    loss2: parseFloat($('mult2Perda').value) || 1
  };
  localStorage.setItem(stateKeys.multipliers, JSON.stringify(mults));
}

function updateSaldoAtual(){
  const si = parseFloat($('saldoInicial').value) || 0;
  const history = JSON.parse(localStorage.getItem(stateKeys.history) || '[]');
  const sum = history.reduce((s,h) => s + (parseFloat(h.result) || 0), 0);
  const atual = si + sum;
  $('saldoAtual').value = "R$ " + formatMoney(atual);
}

function renderHistory(){
  const history = JSON.parse(localStorage.getItem(stateKeys.history) || '[]');
  const tbody = $('historyBody');
  tbody.innerHTML = '';
  history.forEach((h, idx) => {
    const tr = document.createElement('tr');
    const cls = (parseFloat(h.result) || 0) >= 0 ? 'green' : 'red';
    tr.className = cls;
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${h.date}</td>
      <td>R$ ${formatMoney(h.total)}</td>
      <td>R$ ${formatMoney(h.result)}</td>
      <td>${Number(h.pct).toFixed(2)}%</td>
      <td class="small">${h.note || ''}</td>
    `;
    tbody.appendChild(tr);
  });
  $('histCount').innerText = history.length;
  updateSaldoAtual();
}

function calcDistribution(){
  const odd1 = parseFloat($('odd1').value);
  const odd2 = parseFloat($('odd2').value);
  const T = parseFloat($('totalApostado').value);

  if(!T || T <= 0 || !odd1 || !odd2 || odd1 <= 0 || odd2 <= 0){
    alert('Informe corretamente: duas odds válidas (>0) e o valor total a apostar (>0).');
    return null;
  }

  // fórmula de distribuição proporcional para retorno igual (n=2)
  const inv1 = 1/odd1;
  const inv2 = 1/odd2;
  const S = inv1 + inv2;

  const A1 = (T / odd1) / S;
  const A2 = (T / odd2) / S;

  // retornos brutos por aposta
  const ret1 = A1 * odd1;
  const ret2 = A2 * odd2;
  // ret1 e ret2 devem ser iguais (R)
  const R = (T / S);

  // se apenas 1 vencer → o retorno bruto será R; lucro = R - T
  const lucroOne = R - T;

  // se ambas vencerem → soma dos retornos brutos - T
  const totalBothGross = (A1 * odd1) + (A2 * odd2);
  const lucroBoth = totalBothGross - T;

  // percentuais sobre T
  const pctOne = (lucroOne / T) * 100;
  const pctBoth = (lucroBoth / T) * 100;

  return {
    A1, A2, ret1, ret2, R, lucroOne, lucroBoth, pctOne, pctBoth, totalBothGross
  };
}

$('btnCalcular').addEventListener('click', () => {
  saveMultipliers();
  const out = calcDistribution();
  if(!out) return;
  $('stake1').innerText = 'R$ ' + formatMoney(out.A1);
  $('stake2').innerText = 'R$ ' + formatMoney(out.A2);
  $('stake1Detail').innerText = `Retorno bruto se vencer: R$ ${formatMoney(out.ret1)} (R=${formatMoney(out.R)})`;
  $('stake2Detail').innerText = `Retorno bruto se vencer: R$ ${formatMoney(out.ret2)} (R=${formatMoney(out.R)})`;

  $('oneWin').innerText = `Lucro: R$ ${formatMoney(out.lucroOne)}`;
  $('oneWinPct').innerText = `${out.pctOne.toFixed(2)}% sobre T`;

  $('bothWin').innerText = `Lucro: R$ ${formatMoney(out.lucroBoth)}`;
  $('bothWinPct').innerText = `${out.pctBoth.toFixed(2)}% sobre T`;
});

// Aposta concluída: verifica apostas perdidas e adiciona ao histórico, atualiza saldo
$('btnApostaConcluida').addEventListener('click', () => {
  saveMultipliers();
  const T = parseFloat($('totalApostado').value) || 0;
  if(!T || T <= 0){
    alert('Informe o valor total a apostar antes de concluir a aposta.');
    return;
  }
  const losses = parseInt($('apostasPerdidas').value, 10);
  const mults = {
    gain: parseFloat($('multGanho').value) || 1,
    loss1: parseFloat($('mult1Perda').value) || 1,
    loss2: parseFloat($('mult2Perda').value) || 1
  };
  // garante que os campos de odds/total foram calculados pelo menos uma vez
  const out = calcDistribution();
  if(!out) return;

  let result = 0;
  let note = '';
  if(losses === 2){
    // ambas perderam → prejuízo = -T
    result = -T * mults.loss2;
    note = '2 perdas';
  } else if(losses === 1){
    // apenas 1 ganhou → lucroOne
    result = out.lucroOne * mults.loss1;
    note = '1 perda';
  } else {
    // 0 perdas → ambas ganharam
    result = out.lucroBoth * mults.gain;
    note = '0 perdas (ambas ganharam)';
  }

  // montar histórico
  const now = new Date();
  const entry = {
    date: now.toLocaleString('pt-BR'),
    total: Number(T),
    result: Number(Number(result).toFixed(2)),
    pct: Number(((result / T) * 100).toFixed(4)),
    note: note + ( $('team1').value || $('team2').value ? ` | ${$('team1').value || ''} vs ${$('team2').value || ''}` : '')
  };

  const history = JSON.parse(localStorage.getItem(stateKeys.history) || '[]');
  history.push(entry);
  localStorage.setItem(stateKeys.history, JSON.stringify(history));

  // atualiza saldo inicial guardado (não alteramos saldoInicial em si — saldoAtual é calculado)
  renderHistory();

  // limpar campos (exceto: saldo inicial e multipliers)
  resetFieldsKeepMultipliers();

  alert('Aposta registrada no histórico.');
});

// Resetar campos, mas manter multiplicadores e saldo inicial
function resetFieldsKeepMultipliers(){
  // clear inputs that user asked to be reset: team names, odds, total, outputs and losses
  $('team1').value = '';
  $('team2').value = '';
  $('odd1').value = '';
  $('odd2').value = '';
  $('totalApostado').value = '';
  $('apostasPerdidas').value = '0';
  // clear outputs
  $('stake1').innerText = '-';
  $('stake2').innerText = '-';
  $('stake1Detail').innerText = '';
  $('stake2Detail').innerText = '';
  $('oneWin').innerText = '-';
  $('bothWin').innerText = '-';
  $('oneWinPct').innerText = '';
  $('bothWinPct').innerText = '';
}

// resetar histórico (apagar tudo)
$('btnResetHist').addEventListener('click', () => {
  if(!confirm('Tem certeza que deseja resetar o histórico? Esta ação não pode ser desfeita.')) return;
  localStorage.removeItem(stateKeys.history);
  renderHistory();
  updateSaldoAtual();
});

// apagar ultima aposta
$('btnApagarUltima').addEventListener('click', () => {
  const history = JSON.parse(localStorage.getItem(stateKeys.history) || '[]');
  if(history.length === 0){ alert('Histórico vazio.'); return; }
  if(!confirm('Apagar última aposta do histórico?')) return;
  history.pop();
  localStorage.setItem(stateKeys.history, JSON.stringify(history));
  renderHistory();
});

// quando saldo inicial mudar, salvar e atualizar saldo atual
$('saldoInicial').addEventListener('change', () => {
  const si = parseFloat($('saldoInicial').value) || 0;
  localStorage.setItem(stateKeys.saldoInicial, String(si));
  updateSaldoAtual();
});

// multipliers save on change
$('multGanho').addEventListener('change', saveMultipliers);
$('mult1Perda').addEventListener('change', saveMultipliers);
$('mult2Perda').addEventListener('change', saveMultipliers);

// Inicializa
loadState();

// helper: attempts to preserve inputs between reloads (optional)
window.addEventListener('beforeunload', () => {
  // keep multipliers and saldoInicial persisted already
});

</script>
</body>
</html>
