<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gest√£o de Banca</title>
<style>
body { font-family: Arial, sans-serif; padding:10px; background:#f2f2f2; }
.container { max-width:420px; margin:auto; background:#fff; padding:10px; border-radius:8px; }
h2 { text-align:center; margin:5px 0; }
.row { display:flex; gap:6px; }
.row input { width:50%; }
label { font-size:12px; font-weight:bold; }
input, button, textarea {
  width:100%;
  padding:6px;
  font-size:12px;
  margin:4px 0;
  border-radius:5px;
  border:1px solid #ccc;
}
textarea { resize:vertical; height:160px; }
button { background:#222; color:white; border:none; }
button.green { background:#1a8f3a; }
button.red { background:#b52b27; }
button.warn { background:#c77c02; }
button.prev { background:#0057b8; }
button.calc { background:#4b0082; }
.small { font-size:11px; }
table { width:100%; font-size:11px; border-collapse: collapse; margin-top:6px;}
td, th { border:1px solid #ccc; padding:4px; text-align:center; }
.greenRow { background:#d9f5df; }
.redRow { background:#f8d7da; }
</style>
</head>
<body>
<div class="container">
<h2>Gest√£o de Banca</h2>

<label>Banca atual</label>
<input type="number" id="bank">

<label>Valor da pr√≥xima aposta</label>
<input type="number" id="bet">

<label>Odd</label>
<input type="number" step="0.01" id="odd" value="2.00">

<label>M√°x. REDs consecutivos</label>
<input type="number" id="maxReds" value="3">

<button class="warn" onclick="toggleAjustes()">‚öô Ajustes de %</button>
<div id="ajustes" style="display:none;">
  <label>% ap√≥s GREEN</label>
  <input type="number" id="pctGreen" value="30" oninput="atualizarPct()">
  <label>% ap√≥s RED</label>
  <input type="number" id="pctRed" value="100" oninput="atualizarPct()">
</div>

<button class="calc" onclick="calcularBancaMinima()">üí∞ Calcular banca m√≠nima</button>

<div class="row">
  <input type="text" id="home" placeholder="Time casa">
  <input type="text" id="away" placeholder="Time fora">
</div>
<button class="prev" onclick="gerarPrevisao()">PREVIS√ÉO</button>
<textarea id="saidaPrompt" placeholder="A previs√£o aparecer√° aqui..."></textarea>

<button onclick="criarAposta()">Criar aposta</button>

<div id="pendente" class="small"></div>

<button class="green" onclick="resultado('GREEN')">GREEN</button>
<button class="red" onclick="resultado('RED')">RED</button>

<button class="warn" onclick="apagarUltima()">‚Ü© Apagar √∫ltima aposta</button>
<button class="warn" onclick="resetar()">üóë Resetar hist√≥rico</button>

<h3>Hist√≥rico</h3>
<table>
<thead>
<tr><th>#</th><th>Aposta</th><th>Odd</th><th>Res</th><th>Banca</th></tr>
</thead>
<tbody id="historico"></tbody>
</table>
</div>

<script>
let estado = JSON.parse(localStorage.getItem('gestaoEstado')) || {
  bank: 100, baseBet: null, lastBet: null, pendente: null, historico: [],
  reds: 0, maxReds: 3, lastGreen: null,
  pctGreen: 30, pctRed: 100, mostrarAjustes: false
};

const bankInput = document.getElementById('bank');
const betInput = document.getElementById('bet');
const oddInput = document.getElementById('odd');
const maxRedsInput = document.getElementById('maxReds');
const pendenteDiv = document.getElementById('pendente');
const historicoBody = document.getElementById('historico');

function salvar(){ localStorage.setItem('gestaoEstado', JSON.stringify(estado)); render(); }

function render(){
  bankInput.value = estado.bank.toFixed(2);
  betInput.value = calcularProxima().toFixed(2);
  maxRedsInput.value = estado.maxReds;
  document.getElementById("pctGreen").value = estado.pctGreen;
  document.getElementById("pctRed").value = estado.pctRed;
  document.getElementById("ajustes").style.display = estado.mostrarAjustes ? "block" : "none";

  pendenteDiv.innerHTML = estado.pendente
    ? `Aposta pendente: ${estado.pendente.valor.toFixed(2)} @ ${estado.pendente.odd}`
    : "Nenhuma aposta pendente.";

  historicoBody.innerHTML = "";
  estado.historico.forEach((h,i)=>{
    const tr=document.createElement("tr");
    tr.className=h.res==='GREEN'?'greenRow':'redRow';
    tr.innerHTML=`<td>${estado.historico.length-i}</td><td>${h.valor}</td><td>${h.odd}</td><td>${h.res}</td><td>${h.bank}</td>`;
    historicoBody.appendChild(tr);
  });
}

function calcularProxima(){
  if(!estado.baseBet) return 10;

  const basePosGreen = (estado.lastGreen || estado.baseBet) * (1 + estado.pctGreen / 100);

  if(estado.reds === 0 || estado.reds >= estado.maxReds) 
    return Math.min(basePosGreen, estado.bank);

  const base = estado.lastBet || estado.baseBet;

  return Math.min(
    base * (1 + estado.pctRed / 100),
    estado.bank
  );
}

function criarAposta(){
  if(estado.pendente) return alert("Finalize a aposta atual.");
  estado.maxReds=parseInt(maxRedsInput.value);
  const valor=parseFloat(betInput.value), odd=parseFloat(oddInput.value);
  if(!estado.baseBet) estado.baseBet=valor;
  estado.pendente={valor,odd};
  salvar();
}

function resultado(res){
  if(!estado.pendente) return alert("N√£o h√° aposta.");
  const {valor,odd}=estado.pendente;

  if(res==="GREEN"){ 
    estado.bank+=valor*(odd-1); 
    estado.reds=0; 
    estado.lastGreen=valor; 
  } else { 
    estado.bank-=valor; 
    estado.reds++; 
  }

  estado.lastBet = valor;

  estado.historico.unshift({valor:valor.toFixed(2),odd,res,bank:estado.bank.toFixed(2)});
  estado.pendente=null; salvar();
}

function apagarUltima(){
  if(!estado.historico.length) return;
  const u=estado.historico.shift();
  if(u.res==="GREEN") estado.bank-=parseFloat(u.valor)*(u.odd-1);
  else estado.bank+=parseFloat(u.valor);
  salvar();
}

function resetar(){ if(confirm("Resetar tudo?")){ localStorage.removeItem('gestaoEstado'); location.reload(); } }

function toggleAjustes(){ estado.mostrarAjustes=!estado.mostrarAjustes; salvar(); }

function atualizarPct(){
  estado.pctGreen=parseFloat(document.getElementById("pctGreen").value)||0;
  estado.pctRed=parseFloat(document.getElementById("pctRed").value)||0;
  salvar();
}

function calcularBancaMinima(){
  const base = parseFloat(document.getElementById("bet").value);
  const max = parseInt(document.getElementById("maxReds").value);
  const pct = estado.pctRed / 100;

  if (!base || base <= 0) {
    alert("Informe o valor da aposta inicial no campo 'Valor da pr√≥xima aposta'.");
    return;
  }

  let total = 0;

  for (let i = 0; i < max; i++) {
    total += base * Math.pow(1 + pct, i);
  }

  total += base;

  alert(`üí∞ Banca m√≠nima recomendada:\nR$ ${total.toFixed(2)}`);
}

function gerarPrevisao(){
  const casa=home.value.toUpperCase(), fora=away.value.toUpperCase();
  if(!casa||!fora) return alert("Informe os dois times.");
  saidaPrompt.value=`PROMPT DEFINITIVO ‚Äî ‚ÄúMENTALIDADE DE ESPECIALISTAS‚Äù 
(PLACAR PLAUS√çVEL ‚Äî FORMATO NUM√âRICO)

Exemplo: FLAMENGO 2x1 PALMEIRAS

Agora analise o jogo abaixo:

${casa} x ${fora}`;
}

betInput.addEventListener('blur',()=>{ if(betInput.value) betInput.value=parseFloat(betInput.value).toFixed(2); });
oddInput.addEventListener('blur',()=>{ if(oddInput.value) oddInput.value=parseFloat(oddInput.value).toFixed(2); });

render();
</script>
</body>
</html>
