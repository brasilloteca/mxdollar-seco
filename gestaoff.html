<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gest√£o de Banca</title>
<style>
body { font-family: Arial, sans-serif; padding:10px; background:#f2f2f2; }
.container { max-width:420px; margin:auto; background:#fff; padding:10px; border-radius:8px; }
h2 { text-align:center; margin:5px 0; }
.row { display:flex; gap:6px; }
.row input { width:50%; }
.hidden { display:none; }
label { font-size:12px; font-weight:bold; }
input, button, textarea {
  width:100%;
  padding:6px;
  font-size:12px;
  margin:4px 0;
  border-radius:5px;
  border:1px solid #ccc;
}
button { background:#222; color:white; border:none; }
button.green { background:#1a8f3a; }
button.red { background:#b52b27; }
button.warn { background:#c77c02; }
button.prev { background:#0057b8; }
button.cfg { background:#555; }
.small { font-size:11px; }
table { width:100%; font-size:11px; border-collapse: collapse; margin-top:6px;}
td, th { border:1px solid #ccc; padding:4px; text-align:center; }
.greenRow { background:#d9f5df; }
.redRow { background:#f8d7da; }
</style>
</head>
<body>
<div class="container">
<h2>Gest√£o de Banca</h2>

<label>Banca atual</label>
<input type="number" id="bank">

<label>Valor da pr√≥xima aposta</label>
<input type="number" id="bet">

<label>Odd</label>
<input type="number" step="0.01" id="odd" value="2.00">

<label>M√°x. REDs consecutivos</label>
<input type="number" id="maxReds" value="3">

<button class="cfg" onclick="toggleCfg()">‚öô Ajustes de porcentagem</button>

<div id="cfg" class="hidden">
  <div class="row">
    <input type="number" id="gainPct" value="30">
    <input type="number" id="lossPct" value="0">
  </div>
  <div class="row small">
    <div>+% quando ganha</div>
    <div>+% quando perde</div>
  </div>
</div>

<div class="row">
  <input type="text" id="home" placeholder="Time casa">
  <input type="text" id="away" placeholder="Time fora">
</div>

<button class="prev" onclick="gerarPrevisao()">PREVIS√ÉO</button>
<textarea id="saidaPrompt" placeholder="A previs√£o aparecer√° aqui..."></textarea>

<button onclick="criarAposta()">Criar aposta</button>

<div id="pendente" class="small"></div>

<button class="green" onclick="resultado('GREEN')">GREEN</button>
<button class="red" onclick="resultado('RED')">RED</button>

<button class="warn" onclick="apagarUltima()">‚Ü© Apagar √∫ltima aposta</button>
<button class="warn" onclick="resetar()">üóë Resetar hist√≥rico</button>

<h3>Hist√≥rico</h3>
<table>
<thead>
<tr><th>#</th><th>Aposta</th><th>Odd</th><th>Res</th><th>Banca</th></tr>
</thead>
<tbody id="historico"></tbody>
</table>
</div>

<script>
let estado = JSON.parse(localStorage.getItem('gestaoEstado')) || {
  bank: 100,
  baseBet: null,
  pendente: null,
  historico: [],
  reds: 0,
  maxReds: 3,
  lastBet: null,
  gainPct: 30,
  lossPct: 0
};

const bankInput = document.getElementById('bank');
const betInput = document.getElementById('bet');
const oddInput = document.getElementById('odd');
const maxRedsInput = document.getElementById('maxReds');
const gainPctInput = document.getElementById('gainPct');
const lossPctInput = document.getElementById('lossPct');
const pendenteDiv = document.getElementById('pendente');
const historicoBody = document.getElementById('historico');

function salvar() {
  localStorage.setItem('gestaoEstado', JSON.stringify(estado));
  render();
}

function render() {
  bankInput.value = estado.bank.toFixed(2);
  betInput.value = calcularProxima().toFixed(2);
  maxRedsInput.value = estado.maxReds;
  gainPctInput.value = estado.gainPct;
  lossPctInput.value = estado.lossPct;

  pendenteDiv.innerHTML = estado.pendente
    ? `Aposta pendente: ${estado.pendente.valor.toFixed(2)} @ ${estado.pendente.odd}`
    : "Nenhuma aposta pendente.";

  historicoBody.innerHTML = "";
  estado.historico.forEach((h, i) => {
    const tr = document.createElement("tr");
    tr.className = h.res === 'GREEN' ? 'greenRow' : 'redRow';
    tr.innerHTML = `<td>${estado.historico.length - i}</td><td>${h.valor}</td><td>${h.odd}</td><td>${h.res}</td><td>${h.bank}</td>`;
    historicoBody.appendChild(tr);
  });
}

function calcularProxima() {
  if (!estado.lastBet) return 10;

  let valor = estado.lastBet;

  if (estado.reds === 0) {
    valor = valor * (1 + estado.gainPct / 100);
  } else {
    valor = valor * (1 + estado.lossPct / 100);
  }

  return Math.min(valor, estado.bank);
}

function criarAposta() {
  if (estado.pendente) return alert("Finalize a aposta atual.");

  estado.maxReds = parseInt(maxRedsInput.value);
  estado.gainPct = parseFloat(gainPctInput.value) || 0;
  estado.lossPct = parseFloat(lossPctInput.value) || 0;

  const valor = parseFloat(betInput.value);
  const odd = parseFloat(oddInput.value);

  estado.lastBet = valor;
  estado.pendente = { valor, odd };
  salvar();
}

function resultado(res) {
  if (!estado.pendente) return alert("N√£o h√° aposta.");
  const { valor, odd } = estado.pendente;

  if (res === "GREEN") {
    estado.bank += valor * (odd - 1);
    estado.reds = 0;
  } else {
    estado.bank -= valor;
    estado.reds++;
  }

  estado.historico.unshift({
    valor: valor.toFixed(2),
    odd,
    res,
    bank: estado.bank.toFixed(2)
  });

  estado.lastBet = valor;
  estado.pendente = null;
  salvar();
}

function apagarUltima() {
  if (!estado.historico.length) return;
  const ultima = estado.historico.shift();

  if (ultima.res === "GREEN") {
    estado.bank -= parseFloat(ultima.valor) * (ultima.odd - 1);
  } else {
    estado.bank += parseFloat(ultima.valor);
  }
  salvar();
}

function resetar() {
  if (!confirm("Resetar tudo?")) return;
  localStorage.removeItem('gestaoEstado');
  location.reload();
}

function toggleCfg() {
  document.getElementById('cfg').classList.toggle('hidden');
}

function gerarPrevisao() {
  const casa = document.getElementById('home').value.toUpperCase();
  const fora = document.getElementById('away').value.toUpperCase();
  if (!casa || !fora) return alert("Informe os dois times.");
  document.getElementById('saidaPrompt').value = `${casa} x ${fora}`;
}

betInput.addEventListener('blur',()=>{ if(betInput.value!=="") betInput.value=parseFloat(betInput.value).toFixed(2); });
oddInput.addEventListener('blur',()=>{ if(oddInput.value!=="") oddInput.value=parseFloat(oddInput.value).toFixed(2); });

render();
</script>
</body>
</html>
